"use strict";exports.id=287,exports.ids=[287],exports.modules={20287:(e,t,n)=>{n.d(t,{p:()=>A});var i=n(60687),s=n(75018),l=n(73739),r=n(42938),a=n(94482),o=n(80222),c=n(99108),d=n(61939),h=n(62116),u=n(42533),f=n(35933),x=n(86966),m=n(28274),p=n(78590),g=n(45742),j=n(50772),I=n(51060),$=n(43210);let A=({onClose:e,open:t,initialNotes:n})=>{let{params:A}=(0,d.KU)(),[S,F]=(0,$.useState)([]),[N,P]=(0,$.useState)([]),[C,O]=(0,$.useState)([]),[E,D]=(0,$.useState)(""),{selectedVisit:v}=(0,a.E)(),[T,_]=(0,$.useState)({dischargeNotes:"",dischargePlan:"",followUpDetails:"",followUpPlan:"",clinic:"",homeCareInstructions:""}),{data:U}=(0,h.$O)(A?.id,`encounter_type=${r.fA.PRESENTING_COMPLAINTS}`),{data:L}=(0,h.$O)(A?.id,`encounter_type=${r.fA.OUTPATIENT_DIAGNOSIS}`),{data:W}=(0,h.$O)(A?.id,`encounter_type=${r.fA.DISPOSITION}`),{data:w}=(0,u.RO)(A?.id);(0,$.useEffect)(()=>{L&&F(L?.filter(e=>e.visit_id==v.id)[0]?.obs?.filter(e=>e.names.find(e=>e.name===r.W.FINAL_DIAGNOSIS)))},[L,v]),(0,$.useEffect)(()=>{w&&O(w)},[w]),(0,$.useEffect)(()=>{U&&P(U.filter(e=>e.visit_id==v.id)[0]?.obs)},[U,v]),(0,$.useEffect)(()=>{if(n)return void _(n);if(W){let e=W.filter(e=>e.visit_id==v.id)[0]?.obs.find(e=>e.names.find(e=>e.name==r.W.DISCHARGE_HOME)),t=(0,o.m)(e?.children,r.W.DISCHARGE_NOTES),n=(0,o.m)(e?.children,r.W.DISCHARGE_PLAN),i=(0,o.m)(e?.children,r.W.FOLLOWUP_DETAILS),s=(0,o.m)(e?.children,r.W.FOLLOWUP_PLAN),l=(0,o.m)(e?.children,r.W.SPECIALIST_CLINIC),a=(0,o.m)(e?.children,r.W.HOME_CARE_INSTRUCTIONS);(async()=>{let e=await (0,h.cr)(l);_({dischargeNotes:t,dischargePlan:n,followUpDetails:i,followUpPlan:s,clinic:e?.data[0]?.short_name,homeCareInstructions:a})})()}},[W,v]);let b=async()=>{let t=(0,c.U)({presentingComplaints:N,diagnosis:S,labOrders:C,dischargeNotes:T.dischargeNotes,dischargePlan:T.dischargePlan,followUpPlan:`${T.followUpDetails} | ${T.clinic}`,homeCareInstructions:T.homeCareInstructions});await I.A.post(`${E}/print`,{zpl:t}),e()};return(0,i.jsxs)(s.eV,{title:"Patient Summary-QECH AETC",onClose:()=>{},open:t,children:[(0,i.jsxs)(f.A,{spacing:3,children:[(0,i.jsx)(x.A,{}),(0,i.jsxs)(m.default,{children:[(0,i.jsx)(p.default,{variant:"h6",children:"Final Diagnosis"}),(0,i.jsx)(f.A,{spacing:1,mt:1,children:S?.map((e,t)=>(0,i.jsx)(p.default,{children:e.value},`diagnosis-${t}`))})]}),(0,i.jsx)(x.A,{}),(0,i.jsxs)(m.default,{children:[(0,i.jsx)(p.default,{variant:"h6",gutterBottom:!0,children:"Lab Investigations"}),(0,i.jsxs)(g.default,{container:!0,spacing:2,sx:{fontWeight:"bold",mb:1},children:[(0,i.jsx)(g.default,{item:!0,xs:4,children:"Specimen"}),(0,i.jsx)(g.default,{item:!0,xs:4,children:"Test"}),(0,i.jsx)(g.default,{item:!0,xs:4,children:"Result"})]}),C.map((e,t)=>e?.tests?.map((n,s)=>(0,i.jsxs)(g.default,{container:!0,spacing:2,children:[(0,i.jsx)(g.default,{item:!0,xs:4,children:e.specimen?.name||"N/A"}),(0,i.jsx)(g.default,{item:!0,xs:4,children:n.name}),(0,i.jsx)(g.default,{item:!0,xs:4,children:n.result||"Pending"})]},`order-${t}-test-${s}`)))]}),(0,i.jsx)(x.A,{}),!!T.dischargeNotes&&(0,i.jsxs)(m.default,{children:[(0,i.jsx)(p.default,{variant:"h6",gutterBottom:!0,children:"Discharge Notes"}),(0,i.jsx)(p.default,{children:T.dischargeNotes})]}),!!T.dischargePlan&&(0,i.jsxs)(m.default,{children:[(0,i.jsx)(p.default,{variant:"h6",gutterBottom:!0,children:"Discharge Plan"}),(0,i.jsx)(p.default,{children:T.dischargePlan})]}),!!T.followUpPlan&&"Yes"==T.followUpPlan&&(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)(m.default,{children:[(0,i.jsx)(p.default,{variant:"h6",gutterBottom:!0,children:"Follow up Plan"}),(0,i.jsxs)(p.default,{children:[T.followUpDetails," ~ ",T.clinic]})]})}),!!T.homeCareInstructions&&(0,i.jsxs)(m.default,{children:[(0,i.jsx)(p.default,{variant:"h6",gutterBottom:!0,children:"Home care instructions"}),(0,i.jsx)(p.default,{children:T.homeCareInstructions})]}),(0,i.jsx)(l.P,{setPrinter:D})]}),(0,i.jsx)("br",{}),(0,i.jsx)(j.A,{variant:"contained",onClick:b,children:"Print"}),(0,i.jsx)(j.A,{variant:"text",onClick:e,children:"Cancel"})]})}},99108:(e,t,n)=>{function i({presentingComplaints:e,diagnosis:t,labOrders:n,dischargeNotes:i,dischargePlan:s,followUpPlan:l,homeCareInstructions:r}){let a=e=>Math.round(203*e/25.4),o=a(100),c=a(40),d=o-40,h=Math.floor(d/8),u=[{title:"Discharge Notes",content:i||"N/A"},{title:"Investigations",content:n.length?n.flatMap(e=>e.tests.map(e=>`${e.name}:${e.result||"pending"}`)).join(" ! "):"No investigations ordered"},{title:"Final Diagnosis",content:t?.length?t.map(e=>e.value).join(" ! "):"None"},{title:"Discharge Plan",content:s||"N/A"},{title:"Follow Up Plan",content:`${l}`||"N/A"},{title:"Home Care Instructions",content:r||"N/A"}],f=[];u.forEach((e,t)=>{f.push({text:e.title,isTitle:!0,sectionIndex:t}),(function(e){if(!e)return[];let t=e.split(" "),n=[],i="";for(let e of t){if(e.length>h){i&&(n.push(i),i="");for(let t=0;t<e.length;t+=h){let i=e.substring(t,t+h);n.push(i)}continue}let t=i?`${i} ${e}`:e;t.length<=h?i=t:(i&&n.push(i),i=e)}return i&&n.push(i),n})(e.content).forEach(e=>{f.push({text:e,isTitle:!1,sectionIndex:t})})});let x=[],m=[],p=70;for(let e=0;e<f.length;e++){let t=f[e],n=0;if(m.length>0){let e=m[m.length-1];t.sectionIndex!==e.sectionIndex&&(n=10)}let i=n+(t.isTitle?30:25);if(p+i>c-20){if(0===m.length){m.push(t),x.push(m),m=[],p=20;continue}x.push(m),m=[],p=20,e--;continue}m.push(t),p+=i}return m.length>0&&x.push(m),x.map((e,t)=>{let n=20,i=`^XA
^PW${o}
^LL${c}
^CF0,25`;0===t?(i+=`
^FO20,20^FDPatient Summary-QECH AETC^FS
^FO20,60^GB${d},3,3^FS`,n=70):n=20;let s=-1;for(let t of e)t.sectionIndex!==s&&(-1!==s&&(n+=10),s=t.sectionIndex),t.isTitle?(i+=`
^CF0,25
^FO20,${n}^FD${t.text}^FS`,n+=30):(i+=`
^CF0,20
^FO20,${n}^FD${t.text}^FS`,n+=25);return i+`
^XZ`}).join("\n")}function s(e,t="Medication Instructions"){let n=Math.floor(68.21428571428571),i=[],l=[],r=0,a=1;function o(e,n){let i=`^XA
^CF0,25
^FO30,30^${t}${n>1?` (Cont. ${n})`:""}^FS
^FO30,60^GB955,3,3^FS
`,s=68;for(let t of e){for(let e of t)i+=`^FO30,${s}^FD${e}^FS
`,s+=20;s+=10}return i+"^XZ"}return e.forEach(e=>{let t=function(e){let t=e.split(" "),i=[],s="";for(let e of t)(s+" "+e).trim().length<=n?s=(s+" "+e).trim():(i.push(s),s=e);return s&&i.push(s),i}(function(e,t){let n=[e.medicationName,`${e.dose} ${e.doseUnits}`,e.frequency,e.duration,e.formulation,`(${e.prescribedBy})`].filter(Boolean).map(e=>e.replace(/[\\^]/g,""));return`${t}. ${n.join(" | ")}`}(e,a)),s=20*t.length+10;r+s>323&&(i.push(o(l,i.length+1)),l=[],r=0),l.push(t),r+=s,a++}),l.length&&i.push(o(l,i.length+1)),i.join("\n")}n.d(t,{B:()=>s,U:()=>i})}};