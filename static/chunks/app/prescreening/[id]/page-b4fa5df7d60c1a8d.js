(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3478],{11052:(e,t,r)=>{"use strict";r.d(t,{O:()=>x});var n=r(95155),i=r(12115),l=r(59487),a=r(37129),s=r(42281),c=r(23312),o=r(14612);let u={referred:{name:c.W.IS_PATIENT_REFERRED,label:"Is the patient referred?"},urgent:{name:c.W.IS_SITUATION_URGENT,label:" Is the situation urgent?"},Referred:{name:c.W.PATIENT_REFERRED_TO,label:"Patient Referred to"}},d=a.Ik({[u.referred.name]:a.Yj().required().label(u.referred.label),[u.urgent.name]:a.Yj().required().label(u.urgent.label),[u.Referred.name]:a.Yj().label(u.Referred.label)});function x(e){let{onSubmit:t}=e,{serviceAreaOptions:r}=(0,o.C)(),[a,x]=(0,i.useState)({}),m=[{label:"Yes",value:c._Y},{label:"No",value:c.NO}],h=r.map(e=>({id:e.label,label:e.label})),f=a[u.referred.name]==c._Y?h:h.filter(e=>"OPD 2"!==e.id);return(0,n.jsxs)(l.PD,{validationSchema:d,initialValues:(0,s.f6)(u),onSubmit:t,children:[(0,n.jsx)(l.fP,{getValues:x}),(0,n.jsxs)(l.Vp,{children:[(0,n.jsx)(l.b1,{name:u.referred.name,label:u.referred.label,options:m}),(0,n.jsx)(l.b1,{name:u.urgent.name,label:u.urgent.label,options:[...m,{label:"Elective",value:c.W.ELECTIVE}]})]}),a[u.urgent.name]==c.NO&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("br",{}),(0,n.jsx)(l.el,{name:u.Referred.name,label:u.Referred.label,options:f,multiple:!1,sx:{mr:"1ch"}})]}),(a[u.urgent.name]==c._Y||a[u.urgent.name]==c.W.ELECTIVE)&&(0,n.jsx)(l.bL,{message:"Proceed with registration"})]})}},14612:(e,t,r)=>{"use strict";r.d(t,{C:()=>l});var n=r(12115),i=r(86517);let l=()=>{let{data:e,isLoading:t}=(0,i.X)("Service areas"),[r,l]=(0,n.useState)([]);return(0,n.useEffect)(()=>{if(e){let t=e.map(e=>({label:e.name,id:e.uuid}));l(t),t.find(e=>"Other"===e.label)}},[e]),{serviceAreaOptions:r,serviceAreaLoading:t,serviceAreas:e}}},21022:(e,t,r)=>{"use strict";r.d(t,{VQ:()=>a,kC:()=>s,sL:()=>l,uQ:()=>c});var n=r(95155),i=r(59487);let l=e=>{let{children:t,id:r}=e;return(0,n.jsx)(i.Th,{id:r,sx:{fontFamily:"Inter",fontSize:24,fontWeight:700,lineHeight:"29px",letterSpacing:0,textAlign:"center"},children:t})},a=e=>{let{children:t}=e;return(0,n.jsx)(i.Th,{alignSelf:"center",sx:{fontFamily:"Inter",fontSize:14,fontWeight:400,lineHeight:"21px",letterSpacing:0,color:"#636363",width:"50ch",textAlign:"center",my:"2ch"},children:t})},s=e=>{let{children:t,sx:r}=e;return(0,n.jsx)(i.sc,{elevation:0,sx:{display:"flex",flexDirection:"column",justifyContent:"center",px:"5ch",py:"5ch",mb:"2ch",...r},children:t})},c=e=>{let{children:t}=e;return(0,n.jsx)(i.Th,{sx:{fontFamily:"Inter",fontSize:"16px",fontWeight:600,lineHeight:"24px",letterSpacing:"0em",textAlign:"center",my:"2ch"},children:t})}},34661:(e,t,r)=>{"use strict";r.d(t,{j:()=>a});var n=r(95155),i=r(59487),l=r(66766);let a=e=>{let{error:t,onPrimaryAction:r,onSecondaryAction:a}=e;return(0,n.jsxs)(i.jD,{sx:{display:"flex",alignItems:"center",flexDirection:"column",justifyContent:"center"},children:[(0,n.jsx)(l.default,{width:150,height:150,src:"/error.png",alt:"error"}),(0,n.jsx)("br",{}),(0,n.jsxs)(i.Th,{variant:"body2",children:["Error occurred whilst ",(0,n.jsx)("strong",{children:t})]}),(0,n.jsx)("br",{}),(0,n.jsxs)(i.jD,{sx:{display:"flex"},children:[(0,n.jsx)(i.O6,{onClick:r,title:"retry",sx:{mr:"0.5ch"}}),(0,n.jsx)(i.O6,{onClick:a,title:"cancel",variant:"secondary"})]})]})}},37185:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>b});var n=r(95155),i=r(11052),l=r(70482),a=r(21022),s=r(59487),c=r(83436),o=r(23312),u=r(75363),d=r(60283),x=r(87911),m=r(34661),h=r(98386),f=r(12115),j=r(99653),g=r(49262);function b(){let{ServerTime:e}=(0,g.useServerTime)(),{activeVisit:t,patientId:r}=(0,l.gd)(),{navigateTo:b}=(0,l.cq)(),{mutate:p,isPending:y,isSuccess:v}=(0,c.jM)(),{mutate:E,isSuccess:T}=(0,u.FD)(),{loading:S,setLoading:I,completed:R,setCompleted:A,message:_,setMessage:D,showForm:C,setShowForm:N,error:O,setError:F}=(0,d.g)();return(0,f.useEffect)(()=>{v&&(A(1),I(!1))},[v]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(j.V,{title:"Prescreening",link:"/initial-registration/list"}),(0,n.jsxs)(s.Yr,{container:!0,children:[(0,n.jsx)(s.Yr,{xs:1,lg:3,item:!0}),(0,n.jsxs)(s.Yr,{xs:10,lg:6,sx:{display:"flex",flexDirection:"column"},item:!0,children:[(0,n.jsx)("br",{}),(0,n.jsx)("br",{}),(0,n.jsx)(a.sL,{children:"Screening"}),(0,n.jsx)(a.VQ,{children:"This is a list of all patients that went through initial registration successfully and waiting for prescreening."}),C&&(0,n.jsx)(a.kC,{children:(0,n.jsx)(i.O,{onSubmit:n=>{N(!1),I(!0),D("add Screening data... ");let i=e.getServerTimeString();p({encounterType:o.fA.SCREENING_ENCOUNTER,visit:t,patient:r,encounterDatetime:i,obs:[{concept:o.W.IS_PATIENT_REFERRED,value:n[o.W.IS_PATIENT_REFERRED],obsDatetime:i},{concept:o.W.IS_SITUATION_URGENT,value:n[o.W.IS_SITUATION_URGENT],obsDatetime:i},{concept:o.W.PATIENT_REFERRED_TO,value:n[o.W.PATIENT_REFERRED_TO],obsDatetime:i}]}),n[o.W.PATIENT_REFERRED_TO]&&E(t)}})}),1==R&&(0,n.jsx)(x.n,{title:"Patient Screened Successfully",primaryActionText:"screen more",secondaryActionText:"Go Home",onPrimaryAction:()=>{b("/initial-registration/list"),N(!0),A(0)},onSecondaryAction:()=>{b("/dashboard")}}),O&&(0,n.jsx)(m.j,{error:_,onPrimaryAction:()=>{F(!1),A(0),I(!1),N(!0)},onSecondaryAction:()=>{A(0),N(!0),I(!1),F(!1)}}),S&&!O&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("br",{}),(0,n.jsx)("br",{}),(0,n.jsx)(h.n,{message:_,progress:R/1*100})]})]}),(0,n.jsx)(s.Yr,{xs:1,lg:3,item:!0})]})]})}},42281:(e,t,r)=>{"use strict";r.d(t,{iE:()=>l,Zt:()=>d,iL:()=>u,f6:()=>c,gX:()=>o,ZM:()=>x,k$:()=>m}),r(16380);var n=r(24752),i=r.n(n);let l=e=>{let{title:t,text:r,icon:n,onConfirm:l,confirmButtonText:a,cancelButtonText:s="Cancel"}=e;i().fire({title:t,text:r,icon:n,showCancelButton:!0,confirmButtonColor:"#006401",confirmButtonText:a,cancelButtonText:s}).then(e=>{e.isConfirmed&&l()})};var a=r(23312),s=r(6314);let c=e=>Object.keys(e).reduce((t,r)=>(t[e[r].name]="",t),{}),o=(e,t)=>Object.keys(e).map(r=>({concept:r,value:e[r],obsDatetime:t})),u=(e,t,r)=>{let n=Object.keys(e).map(t=>({concept:e[t].name,label:e[t].label})),i=t.map(e=>({concept:e.id,label:e.label}));return[...n,...r.map(e=>({concept:e.value,label:e.label})),...i]},d=async e=>(await s.Fh.initialize(),e.map(e=>({concept:a.W.IMAGE_PART_NAME,value:e.label,obsDateTime:s.Fh.getServerTimeString(),groupMembers:e.formData.obs}))),x=function(e,t,r){return arguments.length>3&&void 0!==arguments[3]&&arguments[3],Array.isArray(e)?e.map(e=>({concept:t,value:e.id,obsDatetime:r})):[]},m=async(e,t,r)=>(await s.Fh.initialize(),Object.entries(t).map(t=>{let[n,i]=t,l=Object.keys(e).find(t=>e[t].name===n);if(!l)return null;let a=e[l].name,c=e[l].coded;return Array.isArray(i)&&i.every(e=>e&&void 0!==e.id)?i.map(e=>({key:a,value:e.id,coded:c})):{concept:a,value:i,coded:c,obsDatetime:r||s.Fh.getServerTimeString()}}).flat().filter(Boolean))},60283:(e,t,r)=>{"use strict";r.d(t,{g:()=>i});var n=r(12115);let i=()=>{let[e,t]=(0,n.useState)(!1),[r,i]=(0,n.useState)(0),[l,a]=(0,n.useState)(!0),[s,c]=(0,n.useState)(""),[o,u]=(0,n.useState)(!1);return{loading:e,setLoading:t,completed:r,setCompleted:i,showForm:l,setShowForm:a,message:s,setMessage:c,error:o,setError:u}}},75363:(e,t,r)=>{"use strict";r.d(t,{b2:()=>u,FD:()=>d,qv:()=>x});var n=r(49262),i=r(44919);let l="visits",a=e=>(0,i.vt)(e,l),s=(e,t)=>(0,i.hc)(e,t,l);var c=r(26715),o=r(5041);let u=()=>{let e=(0,c.jE)();return(0,o.n)({mutationFn:e=>a(e).then(e=>e.data),onSuccess:t=>{e.invalidateQueries({queryKey:["visits"]})}})},d=()=>{let{ServerTime:e}=(0,n.useServerTime)(),t=async t=>s(t,{stopDatetime:e.getServerTimeString()}).then(e=>e.data);return(0,o.n)({mutationFn:t})},x=e=>{let t=(0,c.jE)();return(0,o.n)({mutationFn:e=>s(e,{stopDatetime:"null"}).then(e=>e.data),onSuccess:()=>{t.invalidateQueries({queryKey:["patients",e,"visits"]})}})}},86517:(e,t,r)=>{"use strict";r.d(t,{X:()=>l});var n=r(83436),i=r(19373);let l=e=>{let t=async()=>{var t;let r=await (0,n.P$)(e);return(null==(t=r.data)?void 0:t.length)?r.data[0].set_members.map(e=>{var t,r;let{names:n}=e;return{name:(null==(t=n[0])?void 0:t.name)||"Unknown",uuid:(null==(r=n[0])?void 0:r.uuid)||"N/A"}}):[]};return(0,i.I)({queryKey:[e],queryFn:t,enabled:!!e})}},87911:(e,t,r)=>{"use strict";r.d(t,{n:()=>c});var n=r(95155),i=r(52269),l=r(9670),a=r(33881),s=r(59487);function c(e){let{title:t,primaryActionText:r,secondaryActionText:c,onPrimaryAction:o,onSecondaryAction:u,printButton:d}=e;return(0,n.jsx)(i.default,{display:"flex",alignItems:"center",justifyContent:"center",width:"100%",children:(0,n.jsxs)(i.default,{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",children:[(0,n.jsx)(l.default,{variant:"h1",color:"green",children:(0,n.jsx)(a.cxC,{})}),(0,n.jsx)(l.default,{variant:"h5",fontWeight:"500",children:t}),(0,n.jsxs)(i.default,{mt:"2ch",sx:{display:"flex"},children:[(0,n.jsx)(s.O6,{onClick:o,title:r}),(0,n.jsx)(s.O6,{variant:"secondary",sx:{ml:"0.5ch"},onClick:u,title:c}),d]})]})})}},95156:(e,t,r)=>{Promise.resolve().then(r.bind(r,37185))},98386:(e,t,r)=>{"use strict";r.d(t,{n:()=>u});var n=r(95155);r(12115);var i=r(35881),l=r(52269),a=r(14144),s=r(66712),c=r(59487);let o=(0,i.Ay)(a.A)(e=>{let{theme:t}=e;return{height:10,borderRadius:5,["&.".concat(s.A.colorPrimary)]:{backgroundColor:t.palette.grey["light"===t.palette.mode?200:800]},["& .".concat(s.A.bar)]:{borderRadius:5,backgroundColor:t.palette.primary}}});function u(e){let{message:t,progress:r}=e;return(0,n.jsxs)(l.default,{sx:{flexGrow:1},children:[(0,n.jsx)(o,{variant:"determinate",value:r}),(0,n.jsx)(c.Th,{fontStyle:"italic",children:t})]})}},99653:(e,t,r)=>{"use strict";r.d(t,{V:()=>s});var n=r(95155),i=r(70482),l=r(59487),a=r(33881);let s=e=>{let{title:t,link:r}=e,{navigateTo:s}=(0,i.cq)(),c={fontFamily:"Inter",fontSize:"14px",fontWeight:400,lineHeight:"21px",letterSpacing:"0em",textAlign:"center",mx:"1ch"};return(0,n.jsxs)(l.jD,{sx:{display:"flex",justifyContent:"space-evenly",py:"1ch",borderBottom:"solid 1px #E6E6E6"},children:[(0,n.jsxs)(l.jD,{onClick:()=>s(r),sx:{display:"flex",cursor:"pointer"},children:[(0,n.jsx)(l.Th,{children:(0,n.jsx)(a.oWm,{})}),(0,n.jsx)(l.Th,{sx:c,children:"Go back"})]}),(0,n.jsx)(l.Th,{sx:c,children:t}),(0,n.jsxs)(l.jD,{sx:{display:"flex",alignItems:"center"},children:[(0,n.jsx)(a.M4e,{}),(0,n.jsx)(l.Th,{sx:c,children:"Need any help?"})]})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[5639,16,9344,8250,2225,3740,8320,6987,2073,5062,4821,6448,7129,5976,9487,8441,1684,7358],()=>t(95156)),_N_E=e.O()}]);