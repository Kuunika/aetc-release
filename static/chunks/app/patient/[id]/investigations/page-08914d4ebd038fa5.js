(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[220],{25840:(e,l,t)=>{"use strict";t.r(l),t.d(l,{default:()=>y});var a=t(95155),s=t(59487),n=t(12115),i=t(84406),r=t(48576),o=t(70482),d=t(37129),c=t(23312),u=t(40289),m=t(83436),p=t(49262),b=t(6459),f=t(16380);let h=e=>{let{sampleName:l}=e,t=(0,u.j7)(),a=(0,n.useRef)(l);return(0,n.useEffect)(()=>{l!==a.current&&""!==l&&(t.setFieldValue("tests",[]),t.setFieldValue("emergency",void 0),t.setFieldValue("urgentSample",void 0),a.current=l)},[l,t]),null},x=e=>{let{onClose:l,addRequest:t}=e,{ServerTime:i}=(0,p.useServerTime)(),[u,x]=(0,n.useState)(""),{data:g,isLoading:S,isSuccess:C,refetch:T,isRefetching:y}=(0,r.Xt)(),{data:v,isLoading:E,isSuccess:O,refetch:j,isRefetching:A}=(0,r.Jl)(u),[P,H]=(0,n.useState)(""),[B,F]=(0,n.useState)(""),[N,_]=(0,n.useState)(""),{data:L,isLoading:I,refetch:G,isRefetching:k}=(0,r.G5)(B),{data:D,isLoading:V,refetch:R,isRefetching:M}=(0,r.G5)(N),[K,W]=(0,n.useState)([]),[U,z]=(0,n.useState)([]),[q,w]=(0,n.useState)(0),[Y,X]=(0,n.useState)(0),{params:J}=(0,o.KU)(),{activeVisit:Q,patientId:$}=(0,o.gd)(),{mutate:Z,isPending:ee,isSuccess:el}=(0,m.jM)();(0,n.useEffect)(()=>{j()},[u]),(0,n.useEffect)(()=>{G()},[B]),(0,n.useEffect)(()=>{L&&W(et())},[L]),(0,n.useEffect)(()=>{g&&W(g)},[g,y]),(0,n.useEffect)(()=>{R()},[N]),(0,n.useEffect)(()=>{v&&z(v)},[v]);let et=()=>L?L.map(e=>({...e,names:e.names,name:e.names[0].name})).sort((e,l)=>e.name.localeCompare(l.name)):[];return(0,n.useEffect)(()=>{el&&f.oR.success("Test plan submitted successfully!",{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"colored",transition:f.br})},[el]),(0,a.jsx)(b.h,{loading:ee,children:(0,a.jsxs)(s.PD,{initialValues:{testType:"",sampleType:"",tests:[],emergency:void 0,urgentSample:void 0,description:""},onSubmit:e=>{let t=JSON.parse(e.sampleType),a=i.getServerTimeString(),s=null==e?void 0:e.tests.map(l=>{var t,s;let n=[];return(null==e?void 0:e.emergency)&&n.push({concept:c.W.EMERGENCY,obsDatetime:a,value:e.emergency}),(null==e?void 0:e.urgentSample)&&n.push({concept:c.W.URGENT,obsDatetime:a,value:e.urgentSample}),(null==e?void 0:e.description)&&n.push({concept:c.W.DESCRIPTION,obsDatetime:a,value:e.description}),{concept:null==l?void 0:l.label,obsDatetime:a,value:null==U||null==(s=U.find(e=>e.concept_id===l.id))||null==(t=s.names[0])?void 0:t.uuid,groupMembers:n}}),n=[{concept:t.name,obsDatetime:a,value:t.uuid,groupMembers:s}];w(e=>e+1),X(e=>e+1),x(""),H(""),Z({encounterType:c.fA.LAB_ORDERS_PLAN,visit:Q,patient:$,encounterDatetime:a,obs:n}),l()},validationSchema:d.Ik().shape({tests:d.YO().required().label("Tests"),sampleType:d.Yj().required().label("Sample Type"),description:d.Yj().max(15).label("Description")}),enableReinitialize:!0,children:[(0,a.jsx)(h,{sampleName:u}),(0,a.jsx)(s.el,{getValue:e=>{x(JSON.parse(e).uuid),H(""),X(e=>e+1)},multiple:!1,label:"Sample Type",name:"sampleType",sx:{mb:2},options:K?K.map(e=>{var l;return{label:null==e||null==(l=e.names[0])?void 0:l.name,id:JSON.stringify({name:e.names[0].name,uuid:e.names[0].uuid})}}):[]}),(0,a.jsx)(s.el,{label:"Tests",name:"tests",options:U?U.map(e=>{var l;return{id:e.concept_id,label:null==(l=e.names[0])?void 0:l.name}}):[]},"tests-".concat(u)),(0,a.jsx)("br",{}),(0,a.jsxs)(s.jD,{sx:{display:"flex",width:"50ch"},children:[(0,a.jsx)(s.b1,{getValue:e=>H(e),row:!0,name:"emergency",options:[{value:"Yes",label:"Yes"},{value:"No",label:"No"}],label:"Emergency"}),(0,a.jsx)(s.b1,{getValue:e=>H(e),row:!0,name:"urgentSample",options:[{value:"Yes",label:"Yes"},{value:"No",label:"No"}],label:"Urgent Sample"})]},"radio-buttons-".concat(Y)),(0,a.jsx)(s.A8,{name:"description",label:"Description",id:"description",sx:{width:"100%"}})]},q)})};var g=t(26379),S=t(48455),C=t(86010);function T(){let e=[{id:"bedside",title:"Bedside plan",content:(0,a.jsx)(i.Q,{})},{id:"labForm",title:"Lab order plan",content:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(x,{onClose:()=>{},addRequest:()=>{}}),(0,a.jsx)(g.l,{})]})},{id:"radiology",title:"Radiology (Coming Soon)",content:(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(C.h,{})})}];return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("h3",{style:{marginBottom:"20px"},children:"Investigation Plan"}),(0,a.jsx)(S.M,{sections:e})," "]})}function y(){let{params:e}=(0,o.KU)();return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(s.TF,{}),(0,a.jsxs)(s.MG,{children:[(0,a.jsx)(s.oq,{}),(0,a.jsx)(T,{}),(0,a.jsx)(s.Dh,{size:"medium",sx:{fontSize:"12px",mr:"1px",mt:"1ch",float:"right"},title:"Proceed to Final Diagnosis",url:"/patient/".concat(e.id,"/final-diagnosis")})]})]})}},26379:(e,l,t)=>{"use strict";t.d(l,{l:()=>c});var a=t(95155),s=t(70482),n=t(59487),i=t(9670),r=t(6314),o=t(83436),d=t(23312);let c=()=>{let{params:e}=(0,s.KU)(),{data:l}=(0,o.$O)(null==e?void 0:e.id,"encounter_type=".concat(d.fA.LAB_ORDERS_PLAN)),t=[{field:"specimen",headerName:"Specimen",flex:1,renderCell:e=>e.row.specimen.name},{field:"test",headerName:"Test(s)",flex:1,renderCell:e=>e.row.test.name},{field:"priority",headerName:"Priority",flex:1,renderCell:e=>e.row.test.priority},{field:"date",headerName:"Date",flex:1}],c=[];if(l&&(null==l?void 0:l.length)>0){var u,m;c=null==(m=l[0])||null==(u=m.obs)?void 0:u.flatMap(e=>e.children.map(l=>({test:l.names[0].name,date:(0,r.kh)(e.obs_datetime),specimen:e.names[0].name,priority:function(e){let l=[];if(Array.isArray(e.children))for(let s of e.children){var t,a;let e=null==(a=s.names)||null==(t=a[0])?void 0:t.name;("Emergency"===e||"Urgent"===e)&&l.push(e)}return l.join(", ")}(l),id:l.obs_id})))}return(0,a.jsx)(a.Fragment,{children:0===c.length?(0,a.jsx)(i.default,{children:"No lab orders added"}):(0,a.jsx)(n.WE,{height:"25ch",showTopBar:!1,rowHeight:25,rows:c,columns:t})})}},48576:(e,l,t)=>{"use strict";t.d(l,{fS:()=>g,G5:()=>x,Xt:()=>f,Jl:()=>b,RO:()=>h});var a=t(23312),s=t(44919),n=t(83436);let i=e=>c(e),r=()=>c(a.W.INVESTIGATIONS),o=e=>(0,s.vt)(e,"/lab/orders"),d=e=>(0,s.UK)("/lab/orders?patient=".concat(e)),c=async e=>{let l=await (0,n.cr)(e);return(0,s.UK)("/concepts/".concat(null==l?void 0:l.data[0].uuid,"/set_members?paginate=false"))};var u=t(19373),m=t(26715),p=t(5041);let b=e=>{let l=async()=>i(e).then(e=>e.data.filter(e=>e.names.length>0&&e.names.some(e=>null==e?void 0:e.name)).map(e=>{var l;return{...e,name:null==(l=e.names.find(e=>null==e?void 0:e.name))?void 0:l.name}}).sort((e,l)=>e.name.localeCompare(l.name)));return(0,u.I)({queryKey:["testTypes",e],queryFn:l,enabled:!0})},f=()=>{let e=async()=>r().then(e=>e.data.sort((e,l)=>e.names[0].name.localeCompare(l.names[0].name)));return(0,u.I)({queryKey:["getSpecimenTypes"],queryFn:e,enabled:!0})},h=e=>{let l=async()=>d(e).then(e=>e.data);return(0,u.I)({queryKey:["patientsOrder",e],queryFn:l,enabled:!0})},x=e=>{let l=async()=>c(e).then(e=>e.data);return(0,u.I)({queryKey:["concept-setMembers",e],queryFn:l,enabled:!1})},g=e=>{let l=(0,m.jE)();return(0,p.n)({mutationFn:e=>o(e).then(e=>e.data),onSuccess:()=>{l.invalidateQueries({queryKey:["patientsOrder"]})}})}},72036:(e,l,t)=>{Promise.resolve().then(t.bind(t,25840))},83965:(e,l,t)=>{"use strict";t.d(l,{A:()=>n});var a=t(76856),s=t(95155);let n=(0,a.A)((0,s.jsx)("path",{d:"m12 8-6 6 1.41 1.41L12 10.83l4.59 4.58L18 14z"}),"ExpandLess")},84406:(e,l,t)=>{"use strict";t.d(l,{Q:()=>v});var a=t(95155),s=t(23312),n=t(70482),i=t(16380),r=t(83436),o=t(12115),d=t(52269),c=t(54102),u=t(43388),m=t(9670),p=t(20837),b=t(69439),f=t(39347),h=t(83965),x=t(30821),g=t(6459),S=t(49262);let C={PH:"pH",PCO2:"pCO₂ (mmHg)",PO2:"pO₂ (mmHg)",CTHB:"c_tHb (g/dL)",SO2:"sO₂ (%)",FO2HB:"FO₂Hb (%)",FHHB:"FHHb (%)",FMETHB:"FmetHb (%)",CK:"cK⁺ (mmol/L)",CNA:"cNa⁺ (mmol/L)",CA2:"cCa\xb2⁺ (mmol/L)",CCL:"cCl⁻ (mmol/L)",GLU:"cGlu (mmol/L)",LAC:"cLac (mmol/L)",CTBIL:"ctBil (\xb5mol/L)",PH_T:"pH (T)",PCO2_T:"pCO₂ (T) mmHg",PO2_T:"pO₂ (T) mmHg",P50E:"P50e",BASE_EXCESS:"cBaseExcess (Ecf)c",HCO3:"cHCO₃⁻ (P,st)c",ANION_GAP:"Amion Gap",MOSM:"cmOSm"},T={PH:{name:C.PH,label:C.PH},PCO2:{name:C.PCO2,label:C.PCO2},PO2:{name:C.PO2,label:C.PO2},CTHB:{name:C.CTHB,label:C.CTHB},SO2E:{name:C.SO2,label:C.SO2},FO2HBE:{name:C.FO2HB,label:C.FO2HB},FHHBE:{name:C.FHHB,label:C.FHHB},FMETHB:{name:C.FMETHB,label:C.FMETHB},CK:{name:C.CK,label:C.CK},CNA:{name:C.CNA,label:C.CNA},CA2:{name:C.CA2,label:C.CA2},CCL:{name:C.CCL,label:C.CCL},glucose:{name:C.GLU,label:C.GLU},LACTATE:{name:C.LAC,label:C.LAC},CTBIL:{name:C.CTBIL,label:C.CTBIL},PH_T:{name:C.PH_T,label:C.PH_T},PCO2_T:{name:C.PCO2_T,label:C.PCO2_T},PO2_T:{name:C.PO2_T,label:C.PO2_T},P50E:{name:C.P50E,label:C.P50E},BASE_EXCESS:{name:C.BASE_EXCESS,label:C.BASE_EXCESS},HCO3:{name:C.HCO3,label:C.HCO3},ANION_GAPC:{name:C.ANION_GAP,label:C.ANION_GAP},MOSMC:{name:C.MOSM,label:C.MOSM},mrdt:{name:s.W.MRDT,label:"MRDT",coded:!0},hiv:{name:s.W.HIV,label:"HIV",coded:!0},vdrl:{name:s.W.VDRL,label:"VDRL",coded:!0},pregnancyTest:{name:s.W.PREGNANCY_TEST,label:"Pregnancy Test",coded:!0},urobilinogen:{name:s.W.UROBILINOGEN,label:"Urobilinogen"},leukocytes:{name:s.W.LEUKOCYTES,label:"Leukocytes"},bilirubin:{name:s.W.BILIRUBIN,label:"Bilirubin"},specificGravity:{name:s.W.SPECIFIC_GRAVITY,label:"Specific Gravity"},nitrite:{name:s.W.NITRITE,label:"Nitrite"},ketones:{name:s.W.KETONES,label:"Ketones"},blood:{name:s.W.BLOOD,label:"Blood"},protein:{name:s.W.PROTEIN,label:"Protein"},pocus:{name:s.W.POINT_OF_CARE_ULTRASOUND,label:"Point of care ultrasound"},ecg:{name:s.W.ECG,label:"ECG"},pefr:{name:s.W.PEFR,label:"PEFR"},other:{name:s.W.OTHER,label:"Other"}},y={arterialVenousBloodGasMain:{title:"Arterial/Venous Blood Gas",subSections:["bloodGasValues","oximetryValues","electrolyteValues","metabolicValues","temperatureCorrectedValues","acidBaseStatus"]},bloodGasValues:{title:"Blood Gas Values",fields:[T.PH,T.PCO2,T.PO2]},oximetryValues:{title:"Oximetry Values",fields:[T.CTHB,T.SO2E,T.FO2HBE,T.FHHBE,T.FMETHB]},electrolyteValues:{title:"Electrolyte Values",fields:[T.CK,T.CNA,T.CA2,T.CCL]},metabolicValues:{title:"Metabolic Values",fields:[T.glucose,T.LACTATE,T.CTBIL]},temperatureCorrectedValues:{title:"Temperature Corrected Values",fields:[T.PH_T,T.PCO2_T,T.PO2_T,T.P50E]},acidBaseStatus:{title:"Acid Base Status",fields:[T.BASE_EXCESS,T.HCO3,T.ANION_GAPC,T.MOSMC]},dipstick:{title:"Dipstick",fields:[T.urobilinogen,T.PH,T.leukocytes,T.glucose,T.specificGravity,T.protein,T.nitrite,T.ketones,T.bilirubin,T.blood]},additionalTests:{title:"Additional Tests",fields:[T.pocus,T.ecg,T.pefr,T.other]},pregnancyTest:{title:"Pregnancy Test",fields:[T.pregnancyTest]}},v=()=>{let{activeVisit:e,patientId:l,gender:t}=(0,n.gd)(),{mutate:C,isPending:v,isSuccess:E}=(0,r.jM)(),{ServerTime:O}=(0,S.useServerTime)(),[j,A]=(0,o.useState)(!1),[P,H]=(0,o.useState)(!1),[B,F]=(0,o.useState)(!1),N=(0,o.useCallback)(()=>{let e={};return Object.keys(y).forEach(l=>{let t=y[l];e[l]={open:!1,selectedFields:{}},t.fields&&t.fields.forEach(t=>{e[l].selectedFields[t.name]=!1})}),e},[]),[_,L]=(0,o.useState)(N),I=(0,o.useCallback)(()=>{L(N()),A(!1),H(!1),F(!1)},[N]),G=(0,o.useCallback)(()=>{var e;let l=[],a=e=>{let t=y[e],a=_[e];if(t.fields){let n=t.fields.filter(e=>a.selectedFields[e.name]);n.length>0&&("pregnancyTest"===e?l.push({concept:T.pregnancyTest.name,obsDatetime:O.getServerTimeString(),value:!0}):l.push({concept:s.W.BEDSIDE_INVESTIGATIONS,obsDatetime:O.getServerTimeString(),value:t.title,groupMembers:n.map(e=>({concept:e.name,obsDatetime:O.getServerTimeString(),value:!0}))}))}};return null==(e=y.arterialVenousBloodGasMain.subSections)||e.forEach(e=>{a(e)}),a("dipstick"),a("additionalTests"),"Female"===t&&a("pregnancyTest"),j&&l.push({concept:T.mrdt.name,obsDatetime:O.getServerTimeString(),value:!0}),P&&l.push({concept:T.hiv.name,obsDatetime:O.getServerTimeString(),value:!0}),B&&l.push({concept:T.vdrl.name,obsDatetime:O.getServerTimeString(),value:!0}),l},[_,j,P,B,t]),k=(0,o.useCallback)(t=>{"string"!=typeof t&&t&&t.preventDefault();let a=G();console.log("\uD83D\uDE80 ~ handleSubmit ~ obs:",a),C({encounterType:s.fA.BEDSIDE_INVESTIGATION_PLAN,visit:e,patient:l,encounterDatetime:O.getServerTimeString(),obs:a}),I()},[G,C,e,l,I]);(0,o.useEffect)(()=>{E&&i.oR.success("Bedside test plan submitted successfully!",{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"colored",transition:i.br})},[E]);let D=(0,o.useCallback)(e=>{L(l=>({...l,[e]:{...l[e],open:!l[e].open}}))},[]),V=(0,o.useCallback)((e,l)=>{L(t=>({...t,[e]:{...t[e],selectedFields:{...t[e].selectedFields,[l]:!t[e].selectedFields[l]}}}))},[]),R=(0,o.useCallback)(e=>{let l=y[e],t=_[e];return!!l.fields&&0!==l.fields.length&&l.fields.every(e=>t.selectedFields[e.name])},[_]),M=(0,o.useCallback)(e=>{let l=y[e],t=_[e];if(!l.fields||0===l.fields.length)return!1;let a=l.fields.filter(e=>t.selectedFields[e.name]).length;return a>0&&a<l.fields.length},[_]),K=(0,o.useCallback)(e=>{let l=y[e];if(!l.fields)return;let t=_[e],a=!R(e),s={...t.selectedFields};l.fields.forEach(e=>{s[e.name]=a}),L(l=>({...l,[e]:{...l[e],selectedFields:s,open:!0}}))},[_,R]),W=(0,o.useCallback)(e=>{let l=y[e];return!!l.subSections&&l.subSections.every(e=>{let l=y[e];return!l.fields||0===l.fields.length||R(e)})},[R]),U=(0,o.useCallback)(e=>{let l=y[e];if(!l.subSections)return!1;let t=0,a=0;return l.subSections.forEach(e=>{let l=y[e];l.fields&&(a+=l.fields.length,t+=l.fields.filter(l=>_[e].selectedFields[l.name]).length)}),t>0&&t<a},[_]),z=(0,o.useCallback)(e=>{let l=y[e];if(!l.subSections)return;let t=!W(e);L(a=>{var s;let n={...a};return null==(s=l.subSections)||s.forEach(e=>{let l=y[e];if(l.fields){let a={...n[e].selectedFields};l.fields.forEach(e=>{a[e.name]=t}),n[e]={...n[e],selectedFields:a,open:!0}}}),n[e]={...n[e],open:!0},n})},[W]),q=e=>{var l;let{sectionKey:t}=e,s=y[t],n=_[t],i=R(t),r=M(t);return s.fields&&0!==s.fields.length?(0,a.jsxs)(d.default,{sx:{mb:1},children:[" ",(0,a.jsx)(c.default,{control:(0,a.jsx)(u.default,{checked:i,indeterminate:r&&!i,onChange:()=>K(t),sx:{color:"GrayText"}}),label:(0,a.jsxs)(m.default,{color:"GrayText",onClick:()=>D(t),sx:{fontSize:16,cursor:"pointer",display:"inline-flex",alignItems:"center"},children:[s.title,n.open?(0,a.jsx)(h.A,{sx:{ml:1,fontSize:20}}):(0,a.jsx)(x.A,{sx:{ml:1,fontSize:20}})]})}),(0,a.jsx)(p.A,{in:n.open,children:(0,a.jsx)(d.default,{sx:{pl:4,mt:1},children:null==(l=s.fields)?void 0:l.map(e=>(0,a.jsx)(c.default,{control:(0,a.jsx)(u.default,{checked:n.selectedFields[e.name],onChange:()=>V(t,e.name),name:e.name,id:e.name}),label:e.label},e.name))})})]}):null};return(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)(g.h,{loading:v,children:[(0,a.jsxs)(b.A,{children:[(0,a.jsx)(e=>{var l;let{sectionKey:t}=e,s=y[t],n=_[t],i=W(t),r=U(t);return(0,a.jsxs)(d.default,{sx:{mb:1},children:[(0,a.jsx)(c.default,{control:(0,a.jsx)(u.default,{checked:i,indeterminate:r&&!i,onChange:()=>z(t),sx:{color:"GrayText"}}),label:(0,a.jsxs)(m.default,{color:"GrayText",onClick:()=>D(t),sx:{fontSize:16,cursor:"pointer",display:"inline-flex",alignItems:"center"},children:[s.title,n.open?(0,a.jsx)(h.A,{sx:{ml:1,fontSize:20}}):(0,a.jsx)(x.A,{sx:{ml:1,fontSize:20}})]})}),(0,a.jsx)(p.A,{in:n.open,children:(0,a.jsx)(d.default,{sx:{pl:4,mt:1},children:null==(l=s.subSections)?void 0:l.map(e=>(0,a.jsx)(q,{sectionKey:e},e))})})]})},{sectionKey:"arterialVenousBloodGasMain"}),(0,a.jsx)(d.default,{sx:{mb:1},children:(0,a.jsx)(c.default,{control:(0,a.jsx)(u.default,{checked:j,onChange:()=>A(!j),sx:{color:"GrayText"},name:T.mrdt.name,id:T.mrdt.name}),label:(0,a.jsx)(m.default,{sx:{fontSize:16},color:"GrayText",children:T.mrdt.label})})}),(0,a.jsx)(d.default,{sx:{mb:1},children:(0,a.jsx)(c.default,{control:(0,a.jsx)(u.default,{checked:P,onChange:()=>H(!P),sx:{color:"GrayText"},name:T.hiv.name,id:T.hiv.name}),label:(0,a.jsx)(m.default,{sx:{fontSize:16},color:"GrayText",children:T.hiv.label})})}),(0,a.jsx)(d.default,{sx:{mb:1},children:(0,a.jsx)(c.default,{control:(0,a.jsx)(u.default,{checked:B,onChange:()=>F(!B),sx:{color:"GrayText",fontSize:16},name:T.vdrl.name,id:T.vdrl.name}),label:(0,a.jsx)(m.default,{sx:{fontSize:16},color:"GrayText",children:T.vdrl.label})})}),"Female"===t&&(0,a.jsx)(q,{sectionKey:"pregnancyTest"}),(0,a.jsx)(q,{sectionKey:"dipstick"}),(0,a.jsx)(q,{sectionKey:"additionalTests"})]}),(0,a.jsx)(d.default,{sx:{mb:1},children:(0,a.jsx)(f.A,{type:"submit",variant:"contained",color:"primary",onClick:k,children:"Submit"})})]})})}}},e=>{var l=l=>e(e.s=l);e.O(0,[5639,16,9344,8250,2225,3740,8320,6987,2073,5062,4821,6448,7129,5976,9487,8130,6044,8441,1684,7358],()=>l(72036)),_N_E=e.O()}]);