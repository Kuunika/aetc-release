"use strict";exports.id=5521,exports.ids=[5521],exports.modules={13351:(a,b,c)=>{function d({presentingComplaints:a,diagnosis:b,labOrders:c,dischargeNotes:d,dischargePlan:e,followUpPlan:f,homeCareInstructions:g}){let h=a=>Math.round(203*a/25.4),i=h(100),j=h(40),k=i-40,l=Math.floor(k/8),m=[{title:"Discharge Notes",content:d||"N/A"},{title:"Investigations",content:c.length?c.flatMap(a=>a.tests.map(a=>`${a.name}:${a.result||"pending"}`)).join(" ! "):"No investigations ordered"},{title:"Final Diagnosis",content:b?.length?b.map(a=>a.value).join(" ! "):"None"},{title:"Discharge Plan",content:e||"N/A"},{title:"Follow Up Plan",content:`${f}`||"N/A"},{title:"Home Care Instructions",content:g||"N/A"}],n=[];m.forEach((a,b)=>{n.push({text:a.title,isTitle:!0,sectionIndex:b}),(function(a){if(!a)return[];let b=a.split(" "),c=[],d="";for(let a of b){if(a.length>l){d&&(c.push(d),d="");for(let b=0;b<a.length;b+=l){let d=a.substring(b,b+l);c.push(d)}continue}let b=d?`${d} ${a}`:a;b.length<=l?d=b:(d&&c.push(d),d=a)}return d&&c.push(d),c})(a.content).forEach(a=>{n.push({text:a,isTitle:!1,sectionIndex:b})})});let o=[],p=[],q=70;for(let a=0;a<n.length;a++){let b=n[a],c=0;if(p.length>0){let a=p[p.length-1];b.sectionIndex!==a.sectionIndex&&(c=10)}let d=c+(b.isTitle?30:25);if(q+d>j-20){if(0===p.length){p.push(b),o.push(p),p=[],q=20;continue}o.push(p),p=[],q=20,a--;continue}p.push(b),q+=d}return p.length>0&&o.push(p),o.map((a,b)=>{let c=20,d=`^XA
^PW${i}
^LL${j}
^CF0,25`;0===b?(d+=`
^FO20,20^FDPatient Summary-QECH AETC^FS
^FO20,60^GB${k},3,3^FS`,c=70):c=20;let e=-1;for(let b of a)b.sectionIndex!==e&&(-1!==e&&(c+=10),e=b.sectionIndex),b.isTitle?(d+=`
^CF0,25
^FO20,${c}^FD${b.text}^FS`,c+=30):(d+=`
^CF0,20
^FO20,${c}^FD${b.text}^FS`,c+=25);return d+`
^XZ`}).join("\n")}function e(a,b="Medication Instructions"){let c=Math.floor(68.21428571428571),d=[],f=[],g=0,h=1;function i(a,c){let d=`^XA
^CF0,25
^FO30,30^${b}${c>1?` (Cont. ${c})`:""}^FS
^FO30,60^GB955,3,3^FS
`,e=68;for(let b of a){for(let a of b)d+=`^FO30,${e}^FD${a}^FS
`,e+=20;e+=10}return d+"^XZ"}return a.forEach(a=>{let b=function(a){let b=a.split(" "),d=[],e="";for(let a of b)(e+" "+a).trim().length<=c?e=(e+" "+a).trim():(d.push(e),e=a);return e&&d.push(e),d}(function(a,b){let c=[a.medicationName,`${a.dose} ${a.doseUnits}`,a.frequency,a.duration,a.formulation,`(${a.prescribedBy})`].filter(Boolean).map(a=>a.replace(/[\\^]/g,""));return`${b}. ${c.join(" | ")}`}(a,h)),e=20*b.length+10;g+e>323&&(d.push(i(f,d.length+1)),f=[],g=0),f.push(b),g+=e,h++}),f.length&&d.push(i(f,d.length+1)),d.join("\n")}c.d(b,{B:()=>e,U:()=>d})},65521:(a,b,c)=>{c.d(b,{p:()=>v});var d=c(21124),e=c(80350),f=c(84532),g=c(95745),h=c(12541),i=c(45701),j=c(13351),k=c(82283),l=c(50852),m=c(39739),n=c(53773),o=c(91059),p=c(81637),q=c(79515),r=c(82666),s=c(68730),t=c(12989),u=c(38301);let v=({onClose:a,open:b,initialNotes:c})=>{let{params:v}=(0,k.KU)(),[w,x]=(0,u.useState)([]),[y,z]=(0,u.useState)([]),[A,B]=(0,u.useState)([]),[C,D]=(0,u.useState)(""),{selectedVisit:E}=(0,h.E)(),[F,G]=(0,u.useState)({dischargeNotes:"",dischargePlan:"",followUpDetails:"",followUpPlan:"",clinic:"",homeCareInstructions:""}),{data:H}=(0,l.$O)(v?.id,`encounter_type=${g.fA.PRESENTING_COMPLAINTS}`),{data:I}=(0,l.$O)(v?.id,`encounter_type=${g.fA.OUTPATIENT_DIAGNOSIS}`),{data:J}=(0,l.$O)(v?.id,`encounter_type=${g.fA.DISPOSITION}`),{data:K}=(0,m.RO)(v?.id);(0,u.useEffect)(()=>{I&&x(I?.filter(a=>a.visit_id==E.id)[0]?.obs?.filter(a=>a.names.find(a=>a.name===g.W.FINAL_DIAGNOSIS)))},[I,E]),(0,u.useEffect)(()=>{K&&B(K)},[K]),(0,u.useEffect)(()=>{H&&z(H.filter(a=>a.visit_id==E.id)[0]?.obs)},[H,E]),(0,u.useEffect)(()=>{if(c)return void G(c);if(J){let a=J.filter(a=>a.visit_id==E.id)[0]?.obs.find(a=>a.names.find(a=>a.name==g.W.DISCHARGE_HOME)),b=(0,i.m)(a?.children,g.W.DISCHARGE_NOTES),c=(0,i.m)(a?.children,g.W.DISCHARGE_PLAN),d=(0,i.m)(a?.children,g.W.FOLLOWUP_DETAILS),e=(0,i.m)(a?.children,g.W.FOLLOWUP_PLAN),f=(0,i.m)(a?.children,g.W.SPECIALIST_CLINIC),h=(0,i.m)(a?.children,g.W.HOME_CARE_INSTRUCTIONS);(async()=>{let a=await (0,l.cr)(f);G({dischargeNotes:b,dischargePlan:c,followUpDetails:d,followUpPlan:e,clinic:a?.data[0]?.short_name,homeCareInstructions:h})})()}},[J,E]);let L=async()=>{let b=(0,j.U)({presentingComplaints:y,diagnosis:w,labOrders:A,dischargeNotes:F.dischargeNotes,dischargePlan:F.dischargePlan,followUpPlan:`${F.followUpDetails} | ${F.clinic}`,homeCareInstructions:F.homeCareInstructions});await t.A.post(`${C}/print`,{zpl:b}),a()};return(0,d.jsxs)(e.eV,{title:"Patient Summary-QECH AETC",onClose:()=>{},open:b,children:[(0,d.jsxs)(n.A,{spacing:3,children:[(0,d.jsx)(o.A,{}),(0,d.jsxs)(p.default,{children:[(0,d.jsx)(q.default,{variant:"h6",children:"Final Diagnosis"}),(0,d.jsx)(n.A,{spacing:1,mt:1,children:w?.map((a,b)=>(0,d.jsx)(q.default,{children:a.value},`diagnosis-${b}`))})]}),(0,d.jsx)(o.A,{}),(0,d.jsxs)(p.default,{children:[(0,d.jsx)(q.default,{variant:"h6",gutterBottom:!0,children:"Lab Investigations"}),(0,d.jsxs)(r.default,{container:!0,spacing:2,sx:{fontWeight:"bold",mb:1},children:[(0,d.jsx)(r.default,{item:!0,xs:4,children:"Specimen"}),(0,d.jsx)(r.default,{item:!0,xs:4,children:"Test"}),(0,d.jsx)(r.default,{item:!0,xs:4,children:"Result"})]}),A.map((a,b)=>a?.tests?.map((c,e)=>(0,d.jsxs)(r.default,{container:!0,spacing:2,children:[(0,d.jsx)(r.default,{item:!0,xs:4,children:a.specimen?.name||"N/A"}),(0,d.jsx)(r.default,{item:!0,xs:4,children:c.name}),(0,d.jsx)(r.default,{item:!0,xs:4,children:c.result||"Pending"})]},`order-${b}-test-${e}`)))]}),(0,d.jsx)(o.A,{}),!!F.dischargeNotes&&(0,d.jsxs)(p.default,{children:[(0,d.jsx)(q.default,{variant:"h6",gutterBottom:!0,children:"Discharge Notes"}),(0,d.jsx)(q.default,{children:F.dischargeNotes})]}),!!F.dischargePlan&&(0,d.jsxs)(p.default,{children:[(0,d.jsx)(q.default,{variant:"h6",gutterBottom:!0,children:"Discharge Plan"}),(0,d.jsx)(q.default,{children:F.dischargePlan})]}),!!F.followUpPlan&&"Yes"==F.followUpPlan&&(0,d.jsx)(d.Fragment,{children:(0,d.jsxs)(p.default,{children:[(0,d.jsx)(q.default,{variant:"h6",gutterBottom:!0,children:"Follow up Plan"}),(0,d.jsxs)(q.default,{children:[F.followUpDetails," ~ ",F.clinic]})]})}),!!F.homeCareInstructions&&(0,d.jsxs)(p.default,{children:[(0,d.jsx)(q.default,{variant:"h6",gutterBottom:!0,children:"Home care instructions"}),(0,d.jsx)(q.default,{children:F.homeCareInstructions})]}),(0,d.jsx)(f.P,{setPrinter:D})]}),(0,d.jsx)("br",{}),(0,d.jsx)(s.A,{variant:"contained",onClick:L,children:"Print"}),(0,d.jsx)(s.A,{variant:"text",onClick:a,children:"Cancel"})]})}}};